import*as e from"@wordpress/interactivity";var t,o,n={d:function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},r=(t={getContext:function(){return e.getContext},getElement:function(){return e.getElement},store:function(){return e.store}},o={},n.d(o,t),o);const{__,sprintf:i,_n}=wp.i18n,{speak:c}=wp.a11y,u="surecart-local-storage",s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"live",t=arguments.length>1?arguments[1]:void 0;const o=localStorage.getItem(u),n={live:{},test:{}},r=(JSON.parse(o)||n)[e];return r?.[t]||n},a=e=>"keydown"===e.type&&"Enter"!==e.key&&"Space"!==e.code,l=e=>{const t=document.querySelector?.(e)||null;t&&setTimeout((()=>{t.focus()}),0)},{state:d,actions:m}=(0,r.store)("surecart/checkout",{state:{loading:!1,error:null,promotionCode:"",checkout:{},oldCheckout:{},get itemsCount(){return d.checkout?.line_items_count||0},get hasItems(){return d.itemsCount>0},get discountIsRedeemable(){return"redeemable"===d?.checkout?.discount?.redeemable_status},get lineItemHasScratchAmount(){const{line_item:e}=(0,r.getContext)();return!e?.ad_hoc_amount&&e.price.scratchAmount!==e.price.amount},get isDiscountApplied(){return!!d?.checkout?.discount?.promotion?.code},get checkoutLineItems(){return d.checkout?.line_items?.data||[]},get isEditable(){const{line_item:e}=(0,r.getContext)();return!e?.price?.ad_hoc&&!e?.bump_amount},get hasSubscription(){return(d.checkout?.line_items?.data||[]).some((e=>"month"===e?.price?.recurring_interval&&!!e?.price?.recurring_interval&&!e?.price?.recurring_period_count))},get hasRecurring(){return d?.checkout?.line_items?.data?.some((e=>e?.price?.recurring_interval))},get errorTitle(){return d.error?.title||d.error||""},get errorMessage(){return d.error?.message||""},get lineItemPermalink(){const{line_item:e}=(0,r.getContext)(),t=e?.price?.product;return t?.is_published?t?.permalink:null},get additionalErrors(){return(d?.error?.additional_errors||[]).map((e=>e.message))},get showCartMenuIcon(){const{cartMenuAlwaysShown:e}=(0,r.getContext)();return d.itemsCount>0||e},get itemsCountAriaLabel(){const e=d.itemsCount;return i(_n(/* translators: %d: number of items in the cart */
"Total of %d item in the cart","Total of %d items in the cart",e,"surecart"),e)},get lineItemVariant(){const{line_item:e}=(0,r.getContext)();return(e?.variant_options||[]).filter(Boolean).join(" / ")||null}},callbacks:{getState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e?(0,r.getContext)():(0,r.getContext)()?.[e]||!1},init(){const{mode:e,formId:t}=(0,r.getContext)(),o=s(e,t);m.setCheckout(o,e,t)},syncTabs(e){if(e?.key!==u)return;const{mode:t,formId:o}=(0,r.getContext)(),n=s(t,o);m.setCheckout(n,t,o)},onChangeCheckout:function*(){const{checkout:e,oldCheckout:t}=d;if(JSON.stringify(e?.line_items?.data||[])===JSON.stringify(t?.line_items?.data||[]))return;const{processCheckoutEvents:o}=yield import("@surecart/checkout-events");o(e,t)}},actions:{toggleDiscountInput(e){if(a(e))return!0;e.preventDefault();const t=(0,r.getContext)();t.discountInputOpen=!t.discountInputOpen;const{ref:o}=(0,r.getElement)(),n=o?.parentElement?.querySelector?.("input");n&&setTimeout((()=>n.focus()),0)},setPromotionCode(e){d.promotionCode=e?.target?.value||""},maybeApplyDiscountOnKeyChange(e){if("Escape"!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation()),"Escape"===e.key)return(0,r.getContext)().discountInputOpen=!1,void l("#sc-coupon-trigger");"Enter"===e.key&&m.applyDiscount(e),m.setPromotionCode(e)},applyDiscount:function*(e){if(e.preventDefault(),e.stopPropagation(),!d.promotionCode)return;const{mode:t,formId:o}=(0,r.getContext)();c(__("Applying promotion code.","surecart"),"assertive");const{handleCouponApply:n}=yield import("@surecart/checkout-service"),u=yield*n(d.promotionCode);u&&(c(i(/* translators: %s: promotion code */
__("Promotion code %s has been applied.","surecart"),d.promotionCode),"assertive"),d.error="",m.setCheckout(u,t,o),l("#sc-coupon-remove-discount"))},removeDiscount:function*(){const e=(0,r.getContext)(),{mode:t,formId:o}=e;c(__("Removing promotion code.","surecart"),"assertive");const{handleCouponApply:n}=yield import("@surecart/checkout-service"),i=yield*n(null);i&&(d.promotionCode="",e.discountInputOpen=!1,m.setCheckout(i,t,o),c(__("Promotion code has been removed.","surecart"),"assertive"),l("#sc-coupon-trigger"))},closeCouponOnClickOutside:e=>{const t=(0,r.getContext)();e&&e.target.closest(".sc-coupon-form")||t.discountInputOpen&&(t.discountInputOpen=!1)},setCheckout(e,t,o){let n=s(t,o);if(!n)return;d.oldCheckout=n;let r=JSON.parse(localStorage.getItem(u));r||(r={live:{},test:{}}),t&&e?.live_mode===("live"===t)&&(r={...r,[t]:{...r[t],[o]:e}},localStorage.setItem(u,JSON.stringify(r)),d.checkout=s(t,o))},onQuantityIncrease:async e=>{if(a(e))return!0;const{line_item:t}=(0,r.getContext)(),o=t?.quantity+1;await m.updateLineItem({quantity:o}),c(i(/* translators: %d: quantity */
__("Quantity increased to %d.","surecart"),o),"assertive")},onQuantityDecrease:async e=>{if(a(e))return!0;const{line_item:t}=(0,r.getContext)(),o=t?.quantity-1;o<1||(await m.updateLineItem({quantity:o}),c(i(/* translators: %d: quantity */
__("Quantity decreased to %d.","surecart"),o),"assertive"))},onQuantityChange:async e=>{const t=parseInt(e.target.value||"");await m.updateLineItem({quantity:t}),c(i(/* translators: %d: quantity */
__("Quantity changed to %d.","surecart"),t),"assertive")},updateLineItem:function*(e){d.loading=!0;const{line_item:t,mode:o,formId:n}=(0,r.getContext)(),{updateCheckoutLineItem:i}=yield import("@surecart/checkout-service"),c=yield*i({id:t?.id,data:e});m.setCheckout(c,o,n),d.loading=!1},removeLineItem:function*(){d.loading=!0;const{line_item:e,mode:t,formId:o}=(0,r.getContext)();c(__("Removing line item.","surecart"),"assertive");const{removeCheckoutLineItem:n}=yield import("@surecart/checkout-service"),i=yield*n(e?.id);m.setCheckout(i,t,o),d.loading=!1},updateCheckout(e){const{checkout:t,mode:o,formId:n}=e.detail;m.setCheckout(t,o,n)}}});addEventListener("scCheckoutUpdated",(e=>{document.querySelector("sc-checkout")||m.updateCheckout(e)}));